
/*++ 
 * linux/drivers/media/video/wmt_v4l2/cmos/cmos-dev-ov.c
 * WonderMedia v4l cmos device driver
*
 * Copyright c 2010  WonderMedia  Technologies, Inc.
 *
 * This program is free software: you can redistribute it and/or modify 
 * it under the terms of the GNU General Public License as published by 
 * the Free Software Foundation, either version 2 of the License, or 
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, 
 * but WITHOUT ANY WARRANTY; without even the implied warranty of 
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
 * GNU General Public License for more details. 
 *
 * You should have received a copy of the GNU General Public License 
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
*
 * WonderMedia Technologies, Inc.
 * 4F, 533, Chung-Cheng Road, Hsin-Tien, Taipei 231, R.O.C
--*/
#define CMOS_DEV_OV_C
#include "cmos-dev-ov.h"
#include "../wmt-vid.h"

#include <linux/module.h>


unsigned char ov2640_800_600_cfg_0[]={
0xFF,0x1 ,0x12,0x80,0xFF,0x0 ,0x2C,0xFF,0x2E,0xDF,0xFF,0x1 ,0x12,0x80,0x3C,0x35,
0x11,0xFF,0x4 ,0x28,0x13,0xE5,0x14,0x48,0x2C,0x0C,0x33,0x78,0x3B,0xF7,0x3E,0x0 ,
0x43,0x11,0x16,0x10,0x39,0x82,0x35,0x88,0x22,0x0A,0x37,0x40,0x23,0x0 ,0x34,0xA0,
0x36,0x1A,0x6 ,0x2 ,0x7	,0xC0,0x0D,0xB7,0x0E,0x1 ,0x4C,0x0 ,0x4A,0x81,0x21,0x99,
0x9	,0x2 ,0x24,0x3E,0x25,0x34,0x26,0x81,0x5C,0x0 ,0x63,0x0 ,0x7C,0x0 ,0x61,0x70,
0x62,0x80,0x20,0x80,0x28,0x30,0x6C,0x0 ,0x6E,0x0 ,0x70,0x2 ,0x71,0x94,0x73,0xC1,
0x3D,0x34,0x5A,0x57,0x4F,0xBB,0x50,0x9C,0x6D,0x80,0x39,0x2 ,0x3A,0x33,0x3B,0xFB,
0x3C,0x32,0xFF,0x0 ,0xE0,0x14,0x76,0xFF,0x33,0xA0,0x42,0x20,0x43,0x18,0x4C,0x0 ,
0x83,0xD0,0x88,0x0F,0xD7,0x3 ,0xD9,0x10,0xDA,0x4 ,0xD3,0x82,0xF9,0xD0,0x44,0x6 ,
0xD1,0x7 ,0xD2,0x2 ,0xD2,0x0 ,0xD8,0x11,0xC8,0x8 ,0xC9,0x80,0x7C,0x0 ,0x7D,0x7 ,
0x7C,0x7 ,0x7D,0x20,0x90,0x0 ,0x91,0x0E,0x91,0x1A,0x91,0x31,0x91,0x5A,0x91,0x69,
0x91,0x75,0x91,0x7E,0x91,0x88,0x91,0x8F,0x91,0x96,0x91,0xA3,0x91,0xAF,0x91,0xC4,
0x91,0xD7,0x91,0xE8,0x91,0x20,0x92,0x0 ,0x93,0x6 ,0x93,0xE3,0x93,0x5 ,0x93,0x5 ,
0x93,0x0 ,0x93,0x4 ,0x93,0x0 ,0x93,0x0 ,0x93,0x0 ,0x93,0x0 ,0x93,0x0 ,0x93,0x0 ,
0x96,0x0 ,0x97,0x8 ,0x97,0x19,0x97,0x2 ,0x97,0x0C,0x97,0x24,0x97,0x30,0x97,0x28,
0x97,0x26,0x97,0x2 ,0x97,0x98,0x97,0x80,0x97,0x0 ,0x97,0x0 ,0xC3,0xED,0xC4,0x9A,
0xA4,0x0 ,0xC5,0x11,0xC6,0x51,0xC7,0x10,0xB6,0x66,0xB8,0xA5,0xB7,0x64,0xB9,0x7C,
0xB3,0xAF,0xB4,0x97,0xB5,0xFF,0xB0,0xC5,0xB1,0x94,0xB2,0x0F,0xC4,0x5C,0xA8,0x0 ,
0xC0,0xC8,0xC1,0x96,0x86,0x1D,0x50,0x0 ,0x51,0x90,0x52,0x18,0x53,0x0 ,0x54,0x0 ,
0x55,0x88,0x57,0x0 ,0x5A,0x90,0x5B,0x18,0x5C,0x5 ,0xC3,0xED,0x7F,0x0 ,0xDA,0x4 ,
0xE5,0x1F,0xE1,0x67,0xE0,0x0 ,0xDD,0xFF,0x5	,0x0 ,0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,
0xFF,0x1 ,0x12,0x0 ,0x11,0x0 ,0x17,0x11,0x18,0x75,0x19,0x1 ,0x1A,0x97,0x32,0x36,
0x4F,0xBB,0x50,0x9c,0x5A,0x57,0x6D,0x80,0x0F,0x4F,0x3 ,0x8F,0x7C,0x5 ,0xFF,0x0 ,
0xC0,0xC8,0xC1,0x96,0x8C,0x0 ,0x86,0x1D,0xD7,0x1 ,0xD3,0x82,0xDA,0x4 ,0xE0,0x0 ,
0xE1,0x67,0xDD,0xFF,0xFF,0x1 ,0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,0xFF,0x1 ,0x11,0x1 ,
0xFF,0x0 ,0xC7,0x90,0x92,0x1 ,0x93,0xA0,0x92,0x0 ,0x93,0x6 ,0x92,0x2 ,0x93,0x8 ,
0xC3,0xFD,0xA4,0x20,0x87,0xC0,0x7C,0x8 ,0x7D,0x28,0x7D,0x18,0x96,0x3 ,0x97,0x8 ,
0x97,0x16,0x97,0x20,0x97,0x1B,0x97,0x18,0x97,0x2 ,0xFF,0x1 ,0x0F,0x4F,0x3 ,0x8F,
0x2D,0x0 ,0x2E,0x0 ,0x22,0x0 ,0x70,0x6 ,0x14,0x8 ,0x14,0x48,0xFF,0x0 ,0xE0,0x0 ,
0xDD,0xFF,0xFF,0x1 ,0x0C,0x38,0xFF,0x0 ,0x92,0x1 ,0x93,0xC1,0xFF,0x0 ,0x92,0x1 ,
0x93,0xE1,0xFF,0x0 ,0x7C,0x3 ,0x7D,0x40,0x7D,0x40,0xFF,0x0 ,0x7C,0x1 ,0x7D,0x80,
0x7D,0x0 ,0x7C,0x0A,0x7D,0x6 ,0xFF,0x0 ,0x7C,0x7 ,0x7D,0x20,0x7D,0x20,0x7D,0x20,
0x7D,0x6 ,0xFF,0x0 ,0x7C,0x9 ,0x7D,0x20,0x7D,0x6 ,0xFF,0x1 ,0x24,0x3E,0x25,0x34,
0x26,0x81,
};


unsigned char ov2640_800_600_cfg_1[]={
0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,0xFF,0x1 ,0x11,0x0 ,0xFF,0x0 ,0xC7,0x10,0x94,0x0 ,
0x93,0x6 ,0x93,0xE3,0x93,0x5 ,0x93,0x5 ,0xC3,0xED,0xA4,0x0 ,0x87,0xD0,0x7C,0x8 ,
0x7D,0x20,0x7D,0x20,0x96,0x3 ,0x97,0x0C,0x97,0x24,0x97,0x30,0x97,0x28,0x97,0x26,
0x97,0x2 ,0xFF,0x1 ,0x0F,0x4F,0x3 ,0x8F,0x2D,0x0 ,0x2E,0x0 ,0x22,0x0A,0x70,0x2 ,
0x14,0x8 ,0x14,0x48,0xFF,0x0 ,0xE0,0x0 ,0xDD,0xFF,0xFF,0x1 ,0xC0,0x38,0xFF,0x0 ,
0xDD,0xF1,0xE0,0x4 ,0xFF,0x1 ,0x11,0x1 ,0xFF,0x0 ,0xC7,0x10,0x94,0x0 ,0x93,0x6 ,
0x93,0xE3,0x93,0x5 ,0x93,0x5 ,0xC3,0xED,0xA4,0x0 ,0x87,0xD0,0x7C,0x8 ,0x7D,0x20,
0x7D,0x20,0x96,0x3 ,0x97,0x0C,0x97,0x24,0x97,0x30,0x97,0x28,0x97,0x26,0x97,0x2 ,
0xFF,0x1 ,0x0F,0x4F,0x3	,0x8F,0x2D,0x0 ,0x2E,0x0 ,0x22,0x0A,0x70,0x2 ,0x14,0x8 ,
0x14,0x48,0xFF,0x0 ,0xE0,0x0 ,0xDD,0xFF,0xFF,0x1 ,0x0C,0x38,
};


unsigned char ov2640_800_600_cfg_2[]={
0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,0xE1,0x67,0xDA,0x0 ,0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,
0xFF,0x1 ,0x12,0x0 ,0x11,0x1 ,0x17,0x11,0x18,0x75,0x19,0x1 ,0x1A,0x97,0x32,0x36,
0x4F,0xBB,0x5A,0x57,0x50,0x9C,0x6D,0x80,0xFF,0x0 ,0xC0,0xC8,0xC1,0x96,0x8C,0x0 ,
0x86,0x3D,0x50,0x89,0x51,0x90,0x52,0x2C,0x53,0x0 ,0x54,0x0 ,0x55,0x88,0x57,0x0 ,
0x5A,0xC8,0x5B,0x96,0x5C,0x0 ,0xD3,0x4 ,0xE0,0x0 ,0xDD,0xFF,0xFF,0x1 ,0x0C,0x38,
0xFF,0x0 ,0xDD,0xF1,0xE0,0x4 ,0xFF,0x1 ,0x12,0x0 ,0x11,0x1 ,0x17,0x11,0x18,0x75,
0x19,0x1 ,0x1A,0x97,0x32,0x36,0x4F,0xBB,0x5A,0x57,0x50,0x9C,0x6D,0x80,0xFF,0x0 ,
0xC0,0xC8,0xC1,0x96,0x8C,0x0 ,0x86,0x3D,0x50,0x89,0x51,0x90,0x52,0x2C,0x53,0x0 ,
0x54,0x0 ,0x55,0x88,0x57,0x0 ,0x5A,0xC8,0x5B,0x96,0x5C,0x0 ,0xD3,0x4 ,0xE0,0x0 ,
0xDD,0xFF,0xd3,0x2,0xFF,0x1 ,0x0C,0x38,0X11,0X0 
};



int cmos_ov2640_identify(void)
{
	char data=0x0;
	wmt_vid_i2c_write(CMOS_OV2640_I2C_ADDR,0xff,1 );

       data = wmt_vid_i2c_read(CMOS_OV2640_I2C_ADDR ,0xa) ;
	if (data==0x26){
		printk("find cmos device OV2640\n");
		return 0;
	}

	return -1;
}
int cmos_init_ov2640(int width, int height, int cmos_v_flip, int cmos_h_flip)
{
	int i;
	char addr,data;	
    if( (width == 800) && (height == 600) ) {
	for (i = 0x0; i < sizeof(ov2640_800_600_cfg_0); i+=2){
		addr=ov2640_800_600_cfg_0[i];
		data=ov2640_800_600_cfg_0[i+1];
		wmt_vid_i2c_write(CMOS_OV2640_I2C_ADDR,addr,data );
	}

	for (i = 0x0; i < sizeof(ov2640_800_600_cfg_1); i+=2){
		addr=ov2640_800_600_cfg_1[i];
		data=ov2640_800_600_cfg_1[i+1];
		wmt_vid_i2c_write(CMOS_OV2640_I2C_ADDR,addr,data );
	}
	
	for (i = 0x0; i < sizeof(ov2640_800_600_cfg_2); i+=2){
		addr=ov2640_800_600_cfg_2[i];
		data=ov2640_800_600_cfg_2[i+1];
		wmt_vid_i2c_write(CMOS_OV2640_I2C_ADDR,addr,data );
	}
	
    }
    else {
        /* Not-supported Resolution */
        printk("cmos_init_ov2640() null \n");    
        return -1;
    }
    
    return 0;
} /* End of cmos_init_ov7670() */

int cmos_exit_ov2640(void)
{
 	return 0;
}

unsigned char ov7675_640_480[]={
0x12,0x80,0x09,0x10,0xc1,0x7f,0x11,0x80,0x3a,0x04,0x3d,0xc3,0x12,0x00,0x15,0x00,
0x17,0x13,0x18,0x01,0x32,0xbf,0x19,0x03,0x1a,0x7b,0x03,0x0a,0x0c,0x00,0x3e,0x00,
0x70,0x3a,0x71,0x35,0x72,0x11,0x73,0xf0,0xa2,0x02,0x7a,0x09,0x7b,0x0c,0x7c,0x16,
0x7d,0x28,0x7e,0x48,0x7f,0x57,0x80,0x64,0x81,0x71,0x82,0x7e,0x83,0x89,0x84,0x94,
0x85,0xa8,0x86,0xba,0x87,0xd7,0x88,0xec,0x89,0xf9,0x13,0xe0,0x00,0x00,0x10,0x00,
0x0d,0x40,0x14,0x28,0x24,0x40,0x25,0x38,0x26,0x91,0x9f,0x78,0xa0,0x68,0xa1,0x03,
0xa6,0xd8,0xa7,0xd8,0xa8,0xf0,0xa9,0x90,0xaa,0x14,0x13,0xe5,0x0e,0x61,0x0f,0x4b,
0x16,0x02,0x1e,0x27,0x21,0x02,0x22,0x91,0x29,0x07,0x33,0x0b,0x35,0x0b,0x37,0x1d,
0x38,0x71,0x39,0x2a,0x3c,0x78,0x4d,0x40,0x4e,0x20,0x69,0x00,0x6b,0x0a,0x74,0x10,
0x8d,0x4f,0x8e,0x00,0x8f,0x00,0x90,0x00,0x91,0x00,0x96,0x00,0x9a,0x80,0xb0,0x84,
0xb1,0x0c,0xb2,0x0e,0xb3,0x82,0xb8,0x0a,0x43,0x0a,0x44,0xf2,0x45,0x39,0x46,0x62,
0x47,0x3d,0x48,0x55,0x59,0x83,0x5a,0x0d,0x5b,0xcd,0x5c,0x8c,0x5d,0x77,0x5e,0x16,
0x6c,0x0a,0x6d,0x65,0x6e,0x11,0x6f,0x97,0x43,0xa ,0x44,0xf2,0x45,0x15,0x46,0x40,   
0x47,0x1d,0x48,0x38,0x59,0xa2,0x5a,0x98,0x5b,0xcd,0x5c,0x70,0x5d,0x73,0x5e,0x18,
0x6c,0xa,0x6d,0x65,0x6e,0x11,0x6f,0x9e,0x6a,0x40,0x01,0x56,0x02,0x44,0x13,0xe7,
0x4f,0x87,0x50,0x68,0x51,0x1e,0x52,0x15,0x53,0x7c,0x54,0x91,0x58,0x1e,0x55,0x00,
0x56,0x40,0x57,0x80,0x41,0x38,0x3f,0x00,0x75,0x03,0x76,0x60,0x4c,0x00,0x77,0x01,
0x4b,0x09,0xc9,0x30,0x34,0x11,0x3b,0x12,0xa4,0x88,0x96,0x00,0x97,0x30,0x98,0x20,
0x99,0x30,0x9a,0x84,0x9b,0x29,0x9c,0x03,0x9d,0x99,0x9e,0x7f,0xa5,0x02,0xab,0x02,
0x66,0x05,0x62,0x10,0x63,0x0b,0x65,0x07,0x64,0x0f,0x94,0x0e,0x95,0x10,0x78,0x04,
0x79,0x01,0xc8,0xf0,0x79,0x0f,0xc8,0x00,0x79,0x10,0xc8,0x7e,0x79,0x0a,0xc8,0x80,
0x79,0x0b,0xc8,0x01,0x79,0x0c,0xc8,0xf ,0x79,0x0d,0xc8,0x20,0x79,0x09,0xc8,0x80,
0x79,0x02,0xc8,0xc0,0x79,0x03,0xc8,0x40,0x79,0x05,0xc8,0x30,0x79,0x26,0x76,0xe0,
0xa4,0x81,0x14,0x28,0x3b,0xe2,0xcf,0x8c,0x3b,0xe2,0xcf,0x84,0x3b,0xc2,0xcf,0x84,
0x3b,0x62,0x09,0x00
};

unsigned char ov7675_320_240[]={
0x12,0x80,0x09,0x10,0xc1,0x7f,0x11,0x80,0x3a,0x04,0x3d,0xc3,0x12,0x00,0x15,0x00,
0x17,0x13,0x18,0x01,0x32,0xbf,0x19,0x03,0x1a,0x7b,0x03,0x0a,0x0c,0x00,0x3e,0x00,
0x70,0x3a,0x71,0x35,0x72,0x11,0x73,0xf0,0xa2,0x02,0x7a,0x09,0x7b,0x0c,0x7c,0x16,
0x7d,0x28,0x7e,0x48,0x7f,0x57,0x80,0x64,0x81,0x71,0x82,0x7e,0x83,0x89,0x84,0x94,
0x85,0xa8,0x86,0xba,0x87,0xd7,0x88,0xec,0x89,0xf9,0x13,0xe0,0x00,0x00,0x10,0x00,
0x0d,0x40,0x14,0x28,0x24,0x40,0x25,0x38,0x26,0x91,0x9f,0x78,0xa0,0x68,0xa1,0x03,
0xa6,0xd8,0xa7,0xd8,0xa8,0xf0,0xa9,0x90,0xaa,0x14,0x13,0xe5,0x0e,0x61,0x0f,0x4b,
0x16,0x02,0x1e,0x27,0x21,0x02,0x22,0x91,0x29,0x07,0x33,0x0b,0x35,0x0b,0x37,0x1d,
0x38,0x71,0x39,0x2a,0x3c,0x78,0x4d,0x40,0x4e,0x20,0x69,0x00,0x6b,0x0a,0x74,0x10,
0x8d,0x4f,0x8e,0x00,0x8f,0x00,0x90,0x00,0x91,0x00,0x96,0x00,0x9a,0x80,0xb0,0x84,
0xb1,0x0c,0xb2,0x0e,0xb3,0x82,0xb8,0x0a,0x43,0x0a,0x44,0xf2,0x45,0x39,0x46,0x62,
0x47,0x3d,0x48,0x55,0x59,0x83,0x5a,0x0d,0x5b,0xcd,0x5c,0x8c,0x5d,0x77,0x5e,0x16,
0x6c,0x0a,0x6d,0x65,0x6e,0x11,0x6f,0x97,0x43,0xa ,0x44,0xf2,0x45,0x15,0x46,0x40,   
0x47,0x1d,0x48,0x38,0x59,0xa2,0x5a,0x98,0x5b,0xcd,0x5c,0x70,0x5d,0x73,0x5e,0x18,
0x6c,0xa,0x6d,0x65,0x6e,0x11,0x6f,0x9e,0x6a,0x40,0x01,0x56,0x02,0x44,0x13,0xe7,
0x4f,0x87,0x50,0x68,0x51,0x1e,0x52,0x15,0x53,0x7c,0x54,0x91,0x58,0x1e,0x55,0x00,
0x56,0x40,0x57,0x80,0x41,0x38,0x3f,0x00,0x75,0x03,0x76,0x60,0x4c,0x00,0x77,0x01,
0x4b,0x09,0xc9,0x30,0x34,0x11,0x3b,0x12,0xa4,0x88,0x96,0x00,0x97,0x30,0x98,0x20,
0x99,0x30,0x9a,0x84,0x9b,0x29,0x9c,0x03,0x9d,0x99,0x9e,0x7f,0xa5,0x02,0xab,0x02,
0x66,0x05,0x62,0x10,0x63,0x0b,0x65,0x07,0x64,0x0f,0x94,0x0e,0x95,0x10,0x78,0x04,
0x79,0x01,0xc8,0xf0,0x79,0x0f,0xc8,0x00,0x79,0x10,0xc8,0x7e,0x79,0x0a,0xc8,0x80,
0x79,0x0b,0xc8,0x01,0x79,0x0c,0xc8,0xf ,0x79,0x0d,0xc8,0x20,0x79,0x09,0xc8,0x80,
0x79,0x02,0xc8,0xc0,0x79,0x03,0xc8,0x40,0x79,0x05,0xc8,0x30,0x79,0x26,0x76,0xe0,
0xa4,0x81,0x14,0x28,0x3b,0xe2,0xcf,0x8c,0x3b,0xe2,0xcf,0x84,0x3b,0xc2,0xcf,0x84,
0x3b,0x62,0x09,0x00,0x17,0x13,0x18,0x3b,0x32,0x89,0x19,0x02,0x1A,0x3e,0x03,0x0a,
0xbc,0x12,0x92,0x88,0xb9,0x30,0xe6,0x05,0xe4,0x00,0xe5,0xeb,0xbf,0x00,0xbe,0x00,
0x3e,0x00,0xd2,0x1c,0x1b,0x08,0x75,0x04,0x6f,0x9e,0xb7,0x26,0x6b,0x0a,0x11,0x00,
0x2a,0x00,0x2b,0x00,0x9d,0xF3,0x9e,0xCB,0xa5,0x02,0xab,0x03,
};
int cmos_ov7675_identify(void)
{
	char data=0x0;
	data = wmt_vid_i2c_read(CMOS_OV7675_I2C_ADDR ,0xa) ;
	if (data==0x76){
		printk("find cmos device OV7675\n");
		return 0;
	}
	return -1;
}

int cmos_init_ov7675(int width, int height, int cmos_v_flip, int cmos_h_flip)
{
    char *array_addr;
    char  addr,data;
    int   array_size, i;

    if( (width == 320) && (height == 240) ) {
        array_size = sizeof(ov7675_320_240);
        array_addr = ov7675_320_240;
    }
    else if(width == 640)  {
        array_size = sizeof(ov7675_640_480);
        array_addr = ov7675_640_480;
    }else{
        /* Not-supported Resolution */
        return -1;
    }

    for (i = 0; i <array_size ; i+=2){
        addr = array_addr[i];
        data = array_addr[i+1];

        wmt_vid_i2c_write( CMOS_OV7675_I2C_ADDR, addr, data);

      if (0)
      {
	char ret_data;

	ret_data = wmt_vid_i2c_read(CMOS_OV7675_I2C_ADDR, addr);
	printk("addr %x : write %x, read %x\n",addr, data, ret_data);		
      }		
  }    
    
    	data = 0x0;
	if (cmos_v_flip)
		data |= 0x10;
	
	if (cmos_h_flip)
		data |= 0x20;
	printk("set ov7675 mirror val 0x%02x cmos_v_flip 0x%02x cmos_h_flip 0x%02x\n",data, cmos_v_flip, cmos_h_flip);
       wmt_vid_i2c_write( CMOS_OV7675_I2C_ADDR, 0x1e, data);

       return 0;
} /* End of cmos_init_ov7675() */
int cmos_exit_ov7675(void)
{
 	return 0;
}

/*------------------------------------------------------------------------------*/
/*--------------------End of Function Body -----------------------------------*/

#undef CMOS_DEV_OV_C

